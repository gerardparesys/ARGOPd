#N canvas 76 84 1179 654 10;
#X obj 236 19 inlet;
#X obj 236 91 t b b l;
#N canvas 437 261 539 381 logic 0;
#X obj 109 44 inlet;
#X obj 109 96 f;
#X obj 109 140 select -1 0 1;
#N canvas 245 375 855 403 case-minus-one 0;
#X obj 162 15 inlet;
#X obj 162 66 f;
#X obj 162 146 select -1 0 1;
#X text 380 277 Only do this in the case of startup \, since the first
frame of sigmund~ might actually have zeros (continuations) in it.
Need to start up new voices in those cases \, but not in cases where
we have zeros two frames in a row and yet no voice assignment for that
peak number.;
#X obj 193 39 r \$0-martha-cur-peak-idx;
#X obj 162 88 tabread \$0-martha-trackFlags;
#X obj 210 273 ./lib/send-update-abs \$0;
#X obj 302 221 ./lib/start-new-abs \$0;
#X text 16 243 [./lib/kill-old-abs \$0];
#X text 16 213 This used to be here:;
#X obj 210 308 ./lib/start-new-abs \$0;
#X connect 0 0 1 0;
#X connect 1 0 5 0;
#X connect 2 1 6 0;
#X connect 2 2 7 0;
#X connect 4 0 1 1;
#X connect 5 0 2 0;
#X connect 6 0 10 0;
#X restore 31 304 pd case-minus-one;
#N canvas 109 249 537 436 case-zero 0;
#X obj 85 54 inlet;
#X obj 108 120 f;
#X obj 108 176 select -1 0 1;
#N canvas 481 412 471 289 kill-old-start-new 0;
#X obj 74 44 inlet;
#X obj 74 66 t b b;
#X obj 181 119 ./lib/kill-old-abs \$0;
#X obj 32 177 ./lib/start-new-abs \$0;
#X connect 0 0 1 0;
#X connect 1 0 3 0;
#X connect 1 1 2 0;
#X restore 231 233 pd kill-old-start-new;
#X text 141 299 Don't start a new voice if no voice seems to be assigned
for this continuing track.;
#X obj 139 93 r \$0-martha-cur-peak-idx;
#X obj 109 142 tabread \$0-martha-trackFlags;
#X obj 154 268 ./lib/send-update-abs \$0;
#X obj 14 357 ./lib/kill-old-abs \$0;
#X connect 0 0 1 0;
#X connect 1 0 6 0;
#X connect 2 0 8 0;
#X connect 2 1 7 0;
#X connect 2 2 3 0;
#X connect 5 0 1 1;
#X connect 6 0 2 0;
#X restore 216 300 pd case-zero;
#N canvas 405 298 490 432 case-one 0;
#X obj 85 54 inlet;
#X obj 85 107 f;
#X obj 85 163 select -1 0 1;
#N canvas 282 170 471 289 kill-old-start-new 0;
#X obj 74 44 inlet;
#X obj 74 66 t b b;
#X obj 32 177 ./lib/start-new-abs \$0;
#X obj 169 147 ./lib/kill-old-abs \$0;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X connect 1 1 3 0;
#X restore 231 233 pd kill-old-start-new;
#X obj 116 80 r \$0-martha-cur-peak-idx;
#X obj 85 129 tabread \$0-martha-trackFlags;
#X obj 160 280 ./lib/send-update-abs \$0;
#X obj 37 314 ./lib/kill-old-abs \$0;
#X connect 0 0 1 0;
#X connect 1 0 5 0;
#X connect 2 0 7 0;
#X connect 2 1 6 0;
#X connect 2 2 3 0;
#X connect 4 0 1 1;
#X connect 5 0 2 0;
#X restore 359 273 pd case-one;
#X obj 140 69 r \$0-martha-cur-peak-idx;
#X obj 109 118 tabread \$0-martha-trackFlagsPrev;
#X connect 0 0 1 0;
#X connect 1 0 7 0;
#X connect 2 0 3 0;
#X connect 2 1 4 0;
#X connect 2 2 5 0;
#X connect 6 0 1 1;
#X connect 7 0 2 0;
#X restore 278 433 pd logic;
#X obj 12 249 f;
#X text 296 9 sigmund~'s output comes in batches of -npeak \, but we
process each 4-element list separately.;
#X text 88 223 3) copy current trackFlag into trackFlagsPrev for next
time;
#X obj 341 381 unpack f f f f;
#N canvas 95 240 637 381 logic-storage 0;
#X text 286 71 Same as -npeak;
#X text 286 161 Same as number of voices;
#X text 286 191 Same as -npeak;
#X obj 65 71 table \$0-martha-trackFlags;
#X obj 65 101 table \$0-martha-trackFlagsPrev;
#X obj 65 161 table \$0-martha-voiceAssts;
#X obj 65 191 table \$0-martha-trackVoices;
#X restore 36 438 pd logic-storage;
#X obj 486 229 unpack f f f f;
#X obj 540 300 >=;
#X text 592 207 1) Check if amp is over threshold. If not \, artificially
flag it as -1 so that it will get killed;
#X msg 662 491 -1;
#X obj 591 468 spigot;
#X obj 662 379 select 0;
#X obj 481 483 spigot;
#X text 763 33 \$1: sigmund~'s -npeaks value;
#X text 763 53 \$2: number of voices in the oscillator bank;
#N canvas 569 307 801 492 init 0;
#X obj 366 41 loadbang;
#X obj 366 63 t b b;
#X obj 366 132 f \$1;
#X obj 411 97 f \$2;
#X obj 445 246 t f b;
#X msg 498 309 \; pd-\$1-martha-oscillator-bank clear \;;
#X obj 498 285 f \$0;
#X obj 58 161 pack f f \$0;
#X obj 58 101 r \$0-martha-num-peaks;
#X obj 445 224 r \$0-martha-num-voices;
#X obj 411 117 s \$0-martha-num-voices;
#X obj 366 152 s \$0-martha-num-peaks;
#X obj 103 131 r \$0-martha-num-voices;
#X msg 58 195 \; \$3-martha-trackFlags resize \$1 \; \$3-martha-trackFlagsPrev
resize \$1 \; \$3-martha-trackFlags const -1 \; \$3-martha-trackFlagsPrev
const -1 \; \; \$3-martha-voiceAssts resize \$2 \; \$3-martha-trackVoices
resize \$1 \; \$3-martha-voiceAssts const -1 \; \$3-martha-trackVoices
const -1 \; \$3-martha-voiceAssts bounds 0 \$1 \$2 -1 \; \$3-martha-trackVoices
bounds 0 \$2 \$1 -1 \;;
#N canvas 903 170 457 276 gen-osc-bank 0;
#X obj 55 54 inlet;
#X obj 55 96 pack f \$0;
#X msg 55 126 \; pd-\$2-martha-oscillator-bank obj 50 50 clone ./lib/osc-bank-voice
\$1 \$2 \;;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X restore 429 353 pd gen-osc-bank;
#X msg 156 419 \; \$1-martha-track-switches const 1 \;;
#X obj 156 397 f \$0;
#X obj 156 375 loadbang;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X connect 1 1 3 0;
#X connect 2 0 11 0;
#X connect 3 0 10 0;
#X connect 4 0 14 0;
#X connect 4 1 6 0;
#X connect 6 0 5 0;
#X connect 7 0 13 0;
#X connect 8 0 7 0;
#X connect 9 0 4 0;
#X connect 12 0 7 1;
#X connect 16 0 15 0;
#X connect 17 0 16 0;
#X restore 36 418 pd init;
#X obj 34 591 outlet~;
#X obj 821 104 inlet;
#N canvas 401 25 1047 544 command-parsing 0;
#X obj 49 77 inlet;
#X obj 49 135 list split 1;
#X obj 49 167 t b a;
#X obj 61 267 s;
#X obj 121 229 symbol;
#X obj 33 203 list;
#X obj 33 224 list trim;
#X obj 121 205 makefilename \$0-martha-%s;
#X obj 371 145 r \$0-martha-amp-thresh;
#X floatatom 371 167 10 0 0 0 - - -, f 10;
#X obj 561 145 r \$0-martha-attack-time-range;
#X floatatom 561 189 5 0 0 0 - - -, f 5;
#X floatatom 621 189 5 0 0 0 - - -, f 5;
#X obj 561 167 unpack f f;
#X floatatom 771 189 5 0 0 0 - - -, f 5;
#X floatatom 831 189 5 0 0 0 - - -, f 5;
#X obj 771 167 unpack f f;
#X obj 771 145 r \$0-martha-release-time-range;
#X floatatom 561 279 5 0 0 0 - - -, f 5;
#X floatatom 621 279 5 0 0 0 - - -, f 5;
#X obj 561 257 unpack f f;
#X floatatom 771 279 5 0 0 0 - - -, f 5;
#X floatatom 831 279 5 0 0 0 - - -, f 5;
#X obj 771 257 unpack f f;
#X obj 561 235 r \$0-martha-gliss-range;
#X obj 771 235 r \$0-martha-gliss-onset-delay-range;
#X floatatom 561 399 5 0 0 0 - - -, f 5;
#X floatatom 621 399 5 0 0 0 - - -, f 5;
#X obj 561 377 unpack f f;
#X floatatom 771 399 5 0 0 0 - - -, f 5;
#X floatatom 831 399 5 0 0 0 - - -, f 5;
#X obj 771 377 unpack f f;
#X obj 561 355 r \$0-martha-gliss-dur-range;
#X obj 771 355 r \$0-martha-tremolo-rate-range;
#X obj 371 235 r \$0-martha-dsp-switch;
#X obj 371 265 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 1
1;
#X obj 354 19 loadbang;
#X floatatom 371 337 10 0 0 0 - - -, f 10;
#X obj 371 315 r \$0-martha-transpo;
#X obj 371 455 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X obj 371 425 r \$0-martha-pitch-switch;
#X obj 591 455 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X obj 591 425 r \$0-martha-osc-bandpass-switch;
#X floatatom 631 477 10 0 0 0 - - -, f 10;
#X obj 631 455 r \$0-martha-bandpass-q;
#X floatatom 51 377 5 0 0 0 - - -, f 5;
#X obj 51 355 r \$0-martha-vib-speed;
#X floatatom 211 377 5 0 0 0 - - -, f 5;
#X obj 211 355 r \$0-martha-vib-depth;
#X floatatom 791 477 10 0 0 0 - - -, f 10;
#X obj 791 455 r \$0-martha-bandpass-makeup-gain;
#X obj 371 355 r \$0-martha-transpo-ramptime;
#X floatatom 371 376 10 0 0 0 - - -, f 10;
#X msg 354 49 amp-thresh 0.2 \, attack-time-range 5 10 \, release-time-range
250 500 \, transpo 0 \, transpo-ramptime 40 \, gliss-range 0 0 \, gliss-onset-delay-range
50 750 \, gliss-dur-range 500 2000 \, tremolo-rate-range 0 0 \, pitch-switch
0 \, osc-bandpass-switch 0 \, bandpass-q 350 \, bandpass-makeup-gain
80 \, vib-speed 0 \, vib-depth 0 \, dsp-switch 1;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X connect 1 1 5 1;
#X connect 2 0 5 0;
#X connect 2 1 7 0;
#X connect 4 0 3 1;
#X connect 5 0 6 0;
#X connect 6 0 3 0;
#X connect 7 0 4 0;
#X connect 8 0 9 0;
#X connect 10 0 13 0;
#X connect 13 0 11 0;
#X connect 13 1 12 0;
#X connect 16 0 14 0;
#X connect 16 1 15 0;
#X connect 17 0 16 0;
#X connect 20 0 18 0;
#X connect 20 1 19 0;
#X connect 23 0 21 0;
#X connect 23 1 22 0;
#X connect 24 0 20 0;
#X connect 25 0 23 0;
#X connect 28 0 26 0;
#X connect 28 1 27 0;
#X connect 31 0 29 0;
#X connect 31 1 30 0;
#X connect 32 0 28 0;
#X connect 33 0 31 0;
#X connect 34 0 35 0;
#X connect 36 0 53 0;
#X connect 38 0 37 0;
#X connect 40 0 39 0;
#X connect 42 0 41 0;
#X connect 44 0 43 0;
#X connect 46 0 45 0;
#X connect 48 0 47 0;
#X connect 50 0 49 0;
#X connect 51 0 52 0;
#X connect 53 0 1 0;
#X restore 821 126 pd command-parsing;
#X obj 947 365 switch~;
#X obj 27 191 r \$0-martha-cur-peak-idx;
#X obj 12 275 tabread \$0-martha-trackFlags;
#X obj 207 301 r \$0-martha-cur-peak-idx;
#X obj 12 326 tabwrite \$0-martha-trackFlagsPrev;
#X obj 555 253 r \$0-martha-amp-thresh;
#X obj 540 324 s \$0-martha-amp-thresh-flag;
#X obj 947 333 r \$0-martha-dsp-switch;
#X obj 792 517 r \$0-martha-cur-peak-idx;
#X obj 621 543 tabwrite \$0-martha-trackFlags;
#X obj 481 513 s \$0-martha-cur-peak-amp;
#X obj 411 543 s \$0-martha-cur-peak-freq;
#X obj 646 346 r \$0-martha-amp-thresh-flag;
#X obj 34 561 catch~ \$0-martha-sum-bus;
#X msg 710 434 \; \$1-martha-cur-peak-amp 0 \;;
#X obj 710 414 f \$0;
#N canvas 39 504 526 264 \$0-martha-oscillator-bank 0;
#X obj 50 50 clone ./lib/osc-bank-voice 86 4435;
#X restore 36 458 pd \$0-martha-oscillator-bank;
#X obj 555 274 / 100;
#N canvas 390 56 400 205 pitch-switch-stuff 0;
#X obj 45 28 r \$0-martha-pitch-list;
#X obj 45 50 list prepend 0;
#X obj 45 72 s \$0-martha-pitchify-pitches;
#X obj 45 122 table \$0-martha-pitchify-pitches 8;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X restore 36 488 pd pitch-switch-stuff;
#X obj 391 145 t l l l;
#X obj 518 153 s \$0-martha-cur-peak-idx;
#X obj 518 131 unpack f f f f;
#X obj 234 561 noise~;
#X obj 234 582 s~ \$0-martha-noise-source;
#N canvas 910 411 669 380 vibrato-LFO 0;
#X obj 104 186 pack f 40;
#X obj 104 207 line~;
#X obj 104 228 osc~;
#X obj 104 249 *~;
#X obj 154 236 pack f 40;
#X obj 154 257 line~;
#X obj 154 215 r \$0-martha-vib-depth;
#X obj 104 25 r \$0-martha-vib-speed;
#X obj 104 300 s~ \$0-martha-vibrato-LFO;
#X obj 104 46 select 0;
#X obj 37 95 t b;
#X msg 37 116 0;
#X obj 189 107 delay 50;
#X text 278 117 << wait longer than the frequency ramp time to reset
the phase to beginning of sine phase (0) so that there's no pitch offset
with a 0Hz LFO.;
#X obj 189 149 pack f 100;
#X obj 189 170 line;
#X msg 189 128 -0.25;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X connect 2 0 3 0;
#X connect 3 0 8 0;
#X connect 4 0 5 0;
#X connect 5 0 3 1;
#X connect 6 0 4 0;
#X connect 7 0 9 0;
#X connect 9 0 10 0;
#X connect 9 0 12 0;
#X connect 9 1 0 0;
#X connect 10 0 11 0;
#X connect 11 0 0 0;
#X connect 12 0 16 0;
#X connect 14 0 15 0;
#X connect 15 0 2 1;
#X connect 16 0 14 0;
#X restore 234 602 pd vibrato-LFO;
#X obj 236 46 t l l;
#X obj 236 67 spigot;
#X obj 288 46 list split 1;
#X obj 288 67 tabread \$0-martha-track-switches;
#X obj 821 156 table \$0-martha-track-switches \$1;
#X text 260 471 2) Do logic as laid out in pseudocode, f 20;
#X text 944 603 William Brent \, December 2017;
#X text 944 583 [martha~] version 0.6;
#X connect 0 0 46 0;
#X connect 1 0 3 0;
#X connect 1 1 2 0;
#X connect 1 2 40 0;
#X connect 3 0 23 0;
#X connect 6 1 32 0;
#X connect 6 2 14 0;
#X connect 6 3 12 0;
#X connect 8 2 9 0;
#X connect 9 0 27 0;
#X connect 11 0 30 0;
#X connect 12 0 30 0;
#X connect 13 0 11 0;
#X connect 13 0 36 0;
#X connect 14 0 31 0;
#X connect 19 0 20 0;
#X connect 22 0 3 1;
#X connect 23 0 25 0;
#X connect 24 0 25 1;
#X connect 26 0 38 0;
#X connect 28 0 21 0;
#X connect 29 0 30 1;
#X connect 33 0 12 1;
#X connect 33 0 13 0;
#X connect 33 0 14 1;
#X connect 34 0 18 0;
#X connect 36 0 35 0;
#X connect 38 0 9 1;
#X connect 40 0 6 0;
#X connect 40 1 8 0;
#X connect 40 2 42 0;
#X connect 42 0 41 0;
#X connect 43 0 44 0;
#X connect 46 0 47 0;
#X connect 46 1 48 0;
#X connect 47 0 1 0;
#X connect 48 0 49 0;
#X connect 49 0 47 1;
